<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEWZON</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header>
    <img src="imgs/logo.png" alt="NEWZON Logo" id="logo" />
    <nav id="menu">
      <ul>
        <li><a href="#">HOME</a></li>
        <li><a href="sport/sports.html">CRICKET</a></li>
        <li><a href="daily.html">TOP 5</a></li>
        <li><a href="tech.html">TECH</a></li>
        <li><a href="bus.html">BUSINESS</a></li>
        <li><a href="article/article.html">BETA</a></li>
        <li><a href="test.html">MODELS</a></li>
        <li><a href="newzon-fake/check.html">TRUTH</a></li>
        <li><a href="About.html">ABOUT</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <section class="news-section">
      <p style="text-align: center; padding: 20px;">Loading news from backend...</p>
    </section>

    <aside class="sidebar">
      <!-- Stock and Weather API Containers -->
      <!-- ===== TWEETS (UNCHANGED) ===== -->
      <h2>#Budget2025</h2>
      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Aakash Patel</h3>
            <p>@aakashpatel Â· 2h</p>
          </div>
        </div>
        <p class="tweet-text">"Budget 2025 should prioritize healthcare and education reforms. #India #Budget2025 #Growth"</p>
        <div class="tweet-actions">
          <span>ğŸ” 1.2K</span>
          <span>ğŸ’¬ 324</span>
          <span>â¤ï¸ 8.9K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Neha Sharma</h3>
            <p>@nehasharma Â· 4h</p>
          </div>
        </div>
        <p class="tweet-text">"The focus on infrastructure in Budget 2025 is the key to long-term economic stability. #Budget2025 #Infrastructure #IndiaGrowth"</p>
        <div class="tweet-actions">
          <span>ğŸ” 3.1K</span>
          <span>ğŸ’¬ 512</span>
          <span>â¤ï¸ 12.3K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Ravi Kumar</h3>
            <p>@ravikumar Â· 1d</p>
          </div>
        </div>
        <p class="tweet-text">"I am hopeful that Budget 2025 will focus on boosting small and medium enterprises. #SME #Budget2025 #SupportSMEs"</p>
        <div class="tweet-actions">
          <span>ğŸ” 5.4K</span>
          <span>ğŸ’¬ 1.1K</span>
          <span>â¤ï¸ 25.6K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Priya Mehta</h3>
            <p>@priyamehta Â· 5h</p>
          </div>
        </div>
        <p class="tweet-text">"We need a larger focus on green initiatives in Budget 2025 for a sustainable future. #GreenEconomy #Budget2025 #Sustainability"</p>
        <div class="tweet-actions">
          <span>ğŸ” 2.3K</span>
          <span>ğŸ’¬ 450</span>
          <span>â¤ï¸ 7.5K</span>
        </div>
      </div>

      <h2>#iPhone17Launch</h2>
      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Aman Gupta</h3>
            <p>@amangupta Â· 3h</p>
          </div>
        </div>
        <p class="tweet-text">"The iPhone 17 launch is here! Expect top-tier performance and design. #iPhone17 #TechInnovation #AppleLaunch"</p>
        <div class="tweet-actions">
          <span>ğŸ” 4.2K</span>
          <span>ğŸ’¬ 1.3K</span>
          <span>â¤ï¸ 18.9K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Bacca Bucchi</h3>
            <p>@baccabucci Â· 4h</p>
          </div>
        </div>
        <p class="tweet-text">"This phone right here ought to be legendary ong"</p>
        <div class="tweet-actions">
          <span>ğŸ” 3K</span>
          <span>ğŸ’¬ 512</span>
          <span>â¤ï¸ 121.3K</span>
        </div>
      </div>

      <h2>#DELHI Elections</h2>
      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Rahul Gandhi</h3>
            <p>@rgandhi Â· 3h</p>
          </div>
        </div>
        <p class="tweet-text">"we ain't losing this time yoo"</p>
        <div class="tweet-actions">
          <span>ğŸ” 42.2K</span>
          <span>ğŸ’¬ 7.3K</span>
          <span>â¤ï¸ 223.9K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Priya Sharma</h3>
            <p>@priyasharma Â· 2d</p>
          </div>
        </div>
        <p class="tweet-text">"Delhi's upcoming election is crucial for the future of our city. Let's make the right choice for a brighter tomorrow. #DelhiElection2025 #VoteWisely"</p>
        <div class="tweet-actions">
          <span>ğŸ” 3.1K</span>
          <span>ğŸ’¬ 950</span>
          <span>â¤ï¸ 18.2K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Amit Verma</h3>
            <p>@amitverma Â· 3d</p>
          </div>
        </div>
        <p class="tweet-text">"The Delhi election is a referendum on the city's development. We need a government that delivers for everyone. #DelhiElections #DevelopmentForAll"</p>
        <div class="tweet-actions">
          <span>ğŸ” 4.7K</span>
          <span>ğŸ’¬ 1.3K</span>
          <span>â¤ï¸ 22.9K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Sunita Reddy</h3>
            <p>@sunitareddy Â· 4d</p>
          </div>
        </div>
        <p class="tweet-text">"Delhi's election results will decide the future of education and healthcare in the city. Let's vote for progress! #DelhiElections #BetterDelhi"</p>
        <div class="tweet-actions">
          <span>ğŸ” 2.2K</span>
          <span>ğŸ’¬ 600</span>
          <span>â¤ï¸ 17.4K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Sandeep Kumar</h3>
            <p>@sandeepkumar Â· 1w</p>
          </div>
        </div>
        <p class="tweet-text">"Delhi needs leaders who prioritize safety and security for all citizens. This election is about making Delhi a safer place for everyone. #DelhiElection2025 #SafetyFirst"</p>
        <div class="tweet-actions">
          <span>ğŸ” 3.9K</span>
          <span>ğŸ’¬ 1.0K</span>
          <span>â¤ï¸ 20.8K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Neha Gupta</h3>
            <p>@nehagupta Â· 2d</p>
          </div>
        </div>
        <p class="tweet-text">"The Delhi election will be a defining moment for women's safety in the city. It's time we elect a government that cares for women's rights! #DelhiElections #WomenSafety"</p>
        <div class="tweet-actions">
          <span>ğŸ” 5.1K</span>
          <span>ğŸ’¬ 1.5K</span>
          <span>â¤ï¸ 26.3K</span>
        </div>
      </div>

      <div class="tweet-box">
        <div class="tweet-header">
          <div class="tweet-info">
            <h3>Bacca Bucchi</h3>
            <p>@baccabucci Â· 4h</p>
          </div>
        </div>
        <p class="tweet-text">"lorem ipsum delhi is in good hands, believe me guyz #delhimerijaan. Go and vote for the current party"</p>
        <div class="tweet-actions">
          <span>ğŸ” 3K</span>
          <span>ğŸ’¬ 512</span>
          <span>â¤ï¸ 121.3K</span>
        </div>
      </div>
    </aside>
  </div>

  <!-- NEWS + FACT CHECK + BIAS + CREDIBILITY -->
  <script>
    async function loadNews() {
      const container = document.querySelector(".news-section");
      
      try {
        const res = await fetch("http://localhost:5000/api/news");

        if (!res.ok) {
          throw new Error(`Backend returned ${res.status}`);
        }
        
        const data = await res.json();
        container.innerHTML = "";

        if (data.articles && data.articles.length > 0) {
          data.articles.slice(0, 5).forEach(article => {
            const news = document.createElement("article");
            news.className = "news-article";

            news.innerHTML = `
              <img src="${article.urlToImage || 'imgs/default.jpg'}" alt="" class="article-image">
              <div class="title-container">
                <h2><a href="${article.url}" target="_blank" class="news-title-link">${article.title}</a></h2>
                <p class="news-summary">${article.description || 'No description available'}</p>
                <div class="info-boxes">
<div class="bias-row">
  <span class="truth-score-box">--%</span>

  <div class="political-bias-bar detailed">
    <div class="bias-segment political-left"></div>
    <div class="bias-segment political-neutral"></div>
    <div class="bias-segment political-right"></div>
  </div>
</div>


                <div class="credibility-meter">
                <span class="credibility-score"></span>
                </div>

                <button class="fact-btn">ğŸ” Fact Check</button>
                <div class="fact-result"></div>
              </div>
            `;

            container.appendChild(news);

            const btn = news.querySelector(".fact-btn");
            btn.addEventListener("click", () => {
              const articleText = `${article.title}. ${article.description || ""}`;
              factCheckArticle(btn, articleText);
            });

            // ğŸ”¥ Bias AI
            const biasText = `${article.title}. ${article.description || ""}`;
            analyzeBias(news, biasText);
          });
        } else {
          container.innerHTML = "<p style='text-align: center; padding: 20px;'>No articles found in backend response.</p>";
        }
      } catch (err) {
        console.error("Error fetching news:", err);
        container.innerHTML = `
          <p style="text-align: center; padding: 20px; color: red;">
            âš ï¸ Failed to load news from backend.<br>
            Error: ${err.message}
          </p>
        `;
      }
    }

    document.addEventListener("DOMContentLoaded", loadNews);

    async function factCheckArticle(button, text) {
      const card = button.closest(".news-article");
      const resultDiv = card.querySelector(".fact-result");
      const truthBox = card.querySelector(".truth-score-box");
      const credibilityBox = card.querySelector(".credibility-score");

      resultDiv.innerHTML = "â³ Checking credibility...";

      try {
        const response = await fetch("http://127.0.0.1:8000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text: text })
        });

        const data = await response.json();

        let labelText = "";
        let color = "";

        if (data.final_label === "VERIFIED_BY_SOURCES") {
          labelText = "âœ… Likely True";
          color = "green";
        } else if (data.final_label === "LIKELY_FAKE") {
          labelText = "âŒ Likely Fake";
          color = "red";
        } else {
          labelText = "âš ï¸ Unverified";
          color = "orange";
        }

        truthBox.textContent = `${data.truth_percent}%`;
        truthBox.style.background = color;
        truthBox.style.color = "white";

resultDiv.innerHTML = `
  <div class="insight-layer ${data.final_label.toLowerCase()}">
    
    <div class="insight-top">
      <div class="verdict">
        <span class="check">âœ”</span>
        <span class="verdict-text">Likely True</span>
      </div>

      <div class="confidence-pill">
        ${data.truth_percent}%
      </div>
    </div>

    <div class="insight-meta">
      Sources verified: <strong>${data.source_count}</strong>
    </div>

    <div class="insight-sources">
      ${data.sources.join(" Â· ")}
    </div>

  </div>
`;


        const biasConfidence = parseFloat(card.dataset.biasConfidence || "50");
        const finalCredibility = Math.round((data.truth_percent * 0.7) + (biasConfidence * 0.3));
        credibilityBox.textContent = finalCredibility + "%";

      } catch (error) {
        console.error(error);
        resultDiv.innerHTML = "âš ï¸ Error checking article.";
      }
    }

async function analyzeBias(articleElement, text) {
  try {
    const response = await fetch("http://127.0.0.1:5001/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: text })
    });

    const data = await response.json();
    const bias = data.bias;

    console.log("Bias result:", bias);

    const left = bias.Left || 0;
    const center = bias.Center || 0;
    const right = bias.Right || 0;

    articleElement.dataset.biasConfidence = Math.max(left, center, right);

    const leftBar = articleElement.querySelector(".political-left");
    const centerBar = articleElement.querySelector(".political-neutral");
    const rightBar = articleElement.querySelector(".political-right");

  function normalize(value) {
  return Math.max(value, 3); // Minimum 3% so even tiny values are visible
}

leftBar.style.width = normalize(left) + "%";
centerBar.style.width = normalize(center) + "%";
rightBar.style.width = normalize(right) + "%";

leftBar.title = `Left: ${left.toFixed(2)}%`;
centerBar.title = `Center: ${center.toFixed(2)}%`;
rightBar.title = `Right: ${right.toFixed(2)}%`;


  } catch (err) {
    console.error("Bias API error:", err);
  }
}
</script>
<script>
  fetch("http://127.0.0.1:5001/api/analyze", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      text: "The government should expand welfare programs"
    })
  })
  .then(res => res.json())
  .then(data => {
    console.log("Bias result:", data.bias);
  })
  .catch(err => console.error("API Error:", err));
</script>
</body>
</html>
